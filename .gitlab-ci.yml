stages:
  - init
  - workflows

before_script:
  - export PATH="/miniconda/bin:$PATH"

initialize-conda:
  stage: "init"
  image: "ubuntu:latest"
  script: "bash .circleci/setup.sh"
  cache:
    key: "$(md5sum requirements.txt | cut -f1 -d ' ')"
    paths:
      - "miniconda"
    policy: "push"

run-chipseq:
  stage: "workflows"
  image: "ubuntu:latest"
  script:
    - echo $PATH
    - source activate lcdb-wf-test
    - python ci/get-data.py
    - cd workflows/chipseq
    - ./run_test.sh -n
  cache:
    key: "$(md5sum requirements.txt | cut -f1 -d ' ')"
    paths:
      - "miniconda"
    policy: "pull"

